---
output: github_document
---

# group28: Cardiovascular Disease Prediction Model

## Overview
This R package contains a pre-trained XGBoost machine learning model for predicting cardiovascular disease. It was developed as part of the BIO215 Capstone Project.

## Installation

You can install the development version from GitHub with:

```r
# install.packages("devtools")
devtools::install_github("Ruza0501/group28")
``` 

## Usage Example

Here is how to use the prediction function with sample data:

```r
library(group28)

# 1. Create a dataframe with required biological features
# Note: Please pay attention to factor levels and types!
new_patient <- data.frame(
  age = 20000, 
  height = 165, 
  weight = 68, 
  ap_hi = 120, 
  ap_lo = 80,
  age_years = 54, 
  bmi = 24.9, 
  pulse_pressure = 40, 
  map = 93.3,
  hypertension = 0, # Must be integer (0 or 1)
  
  # Factors with specific levels
  gender = factor("male", levels = c("female", "male")),
  cholesterol = ordered("normal", levels = c("normal", "above_normal", "well_above_normal")),
  gluc = ordered("normal", levels = c("normal", "above_normal", "well_above_normal")),
  smoke = factor("no", levels = c("no", "yes")),
  alco = factor("no", levels = c("no", "yes")),
  active = factor("yes", levels = c("no", "yes")),
  bmi_class = factor("normal", levels = c("normal", "overweight", "obese", "other"))
)

# 2. Run prediction
result <- predict_group28(new_patient)
print(result)
```
## Model Performance

The XGBoost model implemented in this package was trained using a stratified 5-fold cross-validation protocol. It demonstrates strong predictive performance for cardiovascular disease.

### Key Metrics (Test Set)
* **ROC AUC:** 0.7986 (95% CI: 0.791 - 0.806)
* **Accuracy:** 73.3%
* **Sensitivity:** 69.2%
* **Specificity:** 77.4%

### 1. Overall Evaluation Overview
The figure below summarizes the model's performance, including the ROC curve (**AUC = 0.7986**), Precision-Recall curve, Confusion Matrix (Accuracy = 73.30%), and Calibration curve.

![Model Evaluation Overview](model_performance.jpg)

---

### 2. Feature Importance Analysis
Understanding which biological factors drive the predictions is crucial. We analyzed this using XGBoost Gain metric.

#### Top Ranking Features
As shown in the bar plot and table below, **Hypertension**, **Pulse Pressure**, and **Age** are identified as the top three most critical risk factors related to cardiovascular disease in this model.

![Feature Importance Bar Plot](new_feat_bar.jpg)

The exact gain values and other metrics for the top features are detailed in the table below:

![Feature Importance Table](new_feat_table.jpg)

---

### 3. Detailed Interpretation (SHAP)
To explain *how* these features influence the risk, we utilized SHAP (SHapley Additive exPlanations) values.

#### Global Trend (Beeswarm Plot)
This plot shows the overall impact of features.
* **Yellow dots** = High feature values (e.g., high blood pressure).
* **Purple dots** = Low feature values.
* Dots further to the **right** indicate a higher predicted risk of disease.
The plot confirms that high blood pressure and high pulse pressure strongly increase disease risk.

![SHAP Summary Beeswarm](shap_summary.jpg)

#### Individual Prediction Example (Waterfall Plot)
This "waterfall" plot illustrates how the model arrived at a prediction for a single, specific high-risk patient. It shows how each feature's value pushed the prediction probability up (yellow) or down (purple) from the baseline.

![SHAP Waterfall Example](new_shap_waterfall.jpg)
